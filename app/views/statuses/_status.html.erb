<% statusable = status.statusable %>
<% user_profile = status.user.profile %>
<% is_show_project_name ||= false %>

<% if statusable.present? %>
  <div class="status-item" id="status-<%= status.id %>" name="status-<%= status.id %>">
    <div class="pull-left">
      <%= link_to image_tag(user_profile.avatar.normal.url.to_s, class: "avatar normal"), user_profile.user %>
    </div>

    <div class="status-main">
      <div class="status-item-head">
        <%= link_to user_profile.name, user_path(user_profile) %>
        <% if is_show_project_name && status.project %>
          在 <%= link_to status.project.try(:name), project_path(status.project) %>
        <% end %>
        <%= "#{status.action_name}了 " %>
        <%= link_to status.statusable_name, status, "data-turbolinks" => "false" %>
      </div>

      <div class="status-item-body">
        <div class="content">
          <%= render "statuses/statusable", statusable: statusable %>
        </div>

        <div class="actions">
          <span class="created_at">
            <%= timeago_tag status.created_at %>
          </span>
          <%# 这里是和 status 发生关系，这样便于从 notification 那里跳到这个status %>
          <%= relation_for status, action_type: :like, submit_name: "喜欢",
                                       show_count: true, class: "link",
                                       button_class: "btn btn-link btn-sm",
                                       destroy_button_html: fa_icon("heart"),
                                       create_button_html: fa_icon("heart-o") %>
          <%= link_to "回应", new_status_comment_path(status), remote: true %>
          <% if policy(status).destroy? %>
            <%= link_to "删除", status, method: :delete, data: {confirm: t("confirm.delete") } %>
          <% end %>

          <div class="comments">
            <%= render "comments/comments", comments: status.comments %>
            <div id="comment-form"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>
